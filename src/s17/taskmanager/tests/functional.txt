This functional test simulates que funcionality of the task manager package.

Initial setup
=============
In this part of the test we authenticate in the site to create the initial
structure.

    >>> app = layer['app']
    >>> portal = layer['portal']
    >>> request = layer['request']

    >>> from cStringIO import StringIO
    >>> from plone.testing.z2 import Browser
    >>> browser = Browser(app)
    >>> browser.handleErrors = False  # see original exceptions
    >>> portal_url = portal.absolute_url()

    >>> from plone.app.testing import SITE_OWNER_NAME, SITE_OWNER_PASSWORD
    >>> browser.open(portal_url + '/login_form')
    >>> browser.getControl(name='__ac_name').value = SITE_OWNER_NAME
    >>> browser.getControl(name='__ac_password').value = SITE_OWNER_PASSWORD
    >>> browser.getControl(name='submit').click()

    >>> 'You are now logged in' in browser.contents
    True

Adding new user
---------------
admin now adds a new user:

    >>> browser.open(portal_url + '/@@new-user')
    >>> browser.getControl('Full Name').value = 'Some new user'
    >>> browser.getControl('User Name').value = 'someuser'
    >>> browser.getControl('E-mail').value = 'someuser@domain.com'
    >>> browser.getControl('Password').value = 'secret'
    >>> browser.getControl('Confirm password').value = 'secret'
    >>> browser.getControl('Register').click()
    >>> 'User added' in browser.contents
    True


Adding a Panel tasks
--------------------
As admin, we create a Panel Tasks to include the tasks in there:

    >>> browser.open(portal_url)
    >>> browser.getLink('Panel tasks').click()
    >>> browser.getControl('Title').value = 'Panel Tasks'
    >>> browser.getControl('Description').value = 'A panel tasks'
    >>> ctrl = browser.getControl(name='form.widgets.responsible:list')
    >>> ctrl.options
    ['--NOVALUE--', 'someuser', 'test_user_1_']
    >>> ctrl.value = ['someuser']
    >>> browser.getControl('Save').click()
    >>> 'Item created' in browser.contents
    True


Adding a task
--------------
Now we add some tasks in the painel tasks.
    >>> browser.getLink(id='s17-app-taskmanager-task').click()
    >>> browser.getControl('Task Name').value = 'A task'
    >>> ctrl = browser.getControl(name='form.widgets.responsible:list')
    >>> ctrl.options
    ['--NOVALUE--', 'someuser', 'test_user_1_']
    >>> ctrl.value = ['someuser']
    >>> ctrl = browser.getControl(name='form.widgets.priority:list')
    >>> ctrl.options
    ['1', '2', '3']
    >>> ctrl.value = ['2']
    >>> browser.getControl(name='form.widgets.text').value = "<p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Proin eget dui. Phasellus tristique adipiscing justo. Vestibulum mattis, lorem vitae tristique molestie, turpis mi congue ligula, eget placerat libero mi quis massa. Proin pretium dictum nulla.</p>"
    >>> browser.getControl('Save').click()
    >>> 'Item created' in browser.contents
    True

Edit task:

    >>> browser.getLink('Home').click()
    >>> browser.getLink('Panel Tasks').click()
    >>> browser.getLink('A task').click()
    >>> browser.getControl('Edit task').click()
    >>> ctrl = browser.getControl(name='form.widgets.priority:list')
    >>> ctrl.options
    ['1', '2', '3']
    >>> ctrl.value = ['3']
    >>> browser.getControl('Save').click()
    >>> 'Changes saved' in browser.contents
    True

Add response:

First, we'll add a new response without any information:

    >>> browser.getLink('Home').click()
    >>> browser.getLink('Panel Tasks').click()
    >>> browser.getLink('A task').click()
    >>> browser.getControl(name='submit-response').click()
    >>> 'Error' in browser.contents
    True

The real response:

    >>> browser.getLink('Home').click()
    >>> browser.getLink('Panel Tasks').click()
    >>> browser.getLink('A task').click()
    >>> browser.getControl(name='response').value = "<p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Proin eget dui. Phasellus tristique adipiscing justo. Vestibulum mattis, lorem vitae tristique molestie, turpis mi congue ligula, eget placerat libero mi quis massa. Proin pretium dictum nulla.</p>"
    >>> ctrl = browser.getControl(name='transition')
    >>> ctrl.options
    ['', 'close', 'assign', 'reject']
    >>> ctrl.value = ['close']
    >>> ctrl = browser.getControl(name='priority')
    >>> ctrl.options
    ['1', '2', '3']
    >>> ctrl.value = ['1']
    >>> browser.getControl(name='submit-response').click()
    >>> 'Added by' in browser.contents
    True

Edit response:

First, we need to log in with another user

    >>> browser.open(portal_url + '/login_form')
    >>> browser.getControl(name='__ac_name').value = 'someuser'
    >>> browser.getControl(name='__ac_password').value = 'secret'
    >>> browser.getControl(name='submit').click()

    >>> 'You are now logged in' in browser.contents
    True

Now we'll edit the response

    >>> browser.getLink('Home').click()
    >>> browser.getLink('Panel Tasks').click()
    >>> browser.getLink('A task').click()
    >>> browser.getControl(name='edit-response').click()
    >>> 'Edit response' in browser.contents
    True
    >>> browser.getControl('Submit').click()
    >>> 'Changes saved to response id 0' in browser.contents
    True

Delete reponse:

    >>> browser.getLink('Home').click()
    >>> browser.getLink('Panel Tasks').click()
    >>> browser.getLink('A task').click()
    >>> browser.getControl(name='delete-response').click()
    >>> 'Removed response id 0.' in browser.contents
    True


