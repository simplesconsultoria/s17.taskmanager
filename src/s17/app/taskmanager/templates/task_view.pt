<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="s17.app.taskmanager">
<body>

<metal:main fill-slot="content-core">
    <tal:main-macro metal:define-macro="content-core">

        <table class="vertical listing" summary="Task details"
               i18n:attributes="summary"
               tal:define="toLocalizedTime nocall:context/@@plone/toLocalizedTime;">
            <tbody>
            <tr>
                <th width="20%" i18n:translate="">Priority</th>
                <td width="70%" tal:content="context/priority"></td>
            </tr>
            <tr tal:condition="context/responsible">
                <th i18n:translate="">Responsible</th>
                <td tal:content="view/responsible"></td>
            </tr>
            <tr tal:condition="context/initial_date">
                <th i18n:translate="">Initial date</th>
                <td tal:content="python: context.initial_date.strftime('%d/%m/%Y')">
                </td>
            </tr>
            <tr tal:condition="context/end_date">
                <th i18n:translate="">End date</th>
                <td tal:content="context/end_date"></td>
            </tr>
            <tr tal:condition="context/provided_date">
                <th i18n:translate="">Provided date</th>
                <td tal:content="context/provided_date"></td>
            </tr>
            </tbody>
        </table>

        <div tal:content="structure view/w/text/render" />

        <tal:block condition="view/images">
            <fieldset>
                <legend i18n:translate="task_images">Images</legend>
                <tal:images tal:repeat="image view/images">
                    <div class="photoAlbumEntry">
                        <a tal:attributes="href string:${image/absolute_url}/view;
                                        title image/Description">
                    <span class="photoAlbumEntryWrapper">
                        <img src="" alt="" tal:replace="structure python:image.tag(scale='thumb', title=image.Description())" />
                    </span>
                    <span class="photoAlbumEntryTitle" tal:content="image/pretty_title_or_id">
                       Title
                    </span>
                        </a>
                    </div>
                </tal:images>
            </fieldset>
        </tal:block>
        <tal:block condition="view/files">
            <fieldset id="">
                <legend i18n:translate="task_files">Files</legend>
                <ul class="visualNoMarker">
                    <tal:related tal:repeat="item view/files">
                        <li tal:define="desc item/Description;
                                item_type item/portal_type;
                                portal context/@@plone_portal_state/portal;
                                putils portal/plone_utils;
                                item_type_class python:'contenttype-' + putils.normalizeString(item_type);
                                item_wf_state item/review_state | python:getInfoFor(item, 'review_state', '');
                                item_wf_state_class python:'state-' + putils.normalizeString(item_wf_state);
                                item_url item/getURL;">
                    <span tal:attributes="class item_type_class">
                        <a href="" class="visualIconPadding"
                           tal:attributes="href item_url;
                                           title desc;"
                           tal:content="item/pretty_title_or_id">
                        </a>
                    </span>
                        </li>
                    </tal:related>
                </ul>
            </fieldset>
        </tal:block>
        <div class="visualClear"><!----></div>

        <tal:responses repeat="response_info view/responses">
            <div class="response-reply"
                 tal:define="id response_info/id;
                     response nocall:response_info/response;
                     html response_info/html;
                     toLocalizedTime nocall:context/@@plone/toLocalizedTime;">

                <div class="response-actions"
                     tal:condition="view/can_edit_response|view/can_delete_response">
                    <form method="post"
                          tal:attributes="action string:@@task_response_edit"
                          tal:condition="view/can_edit_response">
                        <input type="hidden" name="response_id" tal:attributes="value id" />
                        <input class="standalone"
                               type="submit"
                               i18n:attributes="value"
                               value="Edit"
                                />
                    </form>
                    <form method="post"
                          tal:attributes="action string:@@task_response_delete"
                          tal:condition="view/can_delete_response">
                        <input type="hidden" name="response_id" tal:attributes="value id" />
                        <input class="destructive"
                               type="submit"
                               i18n:attributes="value"
                               value="Delete"
                                />
                    </form>
                </div>

                <div class="response-info">
                    <span i18n:translate="task_added_by">Added by</span>
                <span class="contact-user"
                      tal:define="pas_member context/@@pas_member;
                                  creator python:pas_member.info(response.creator)"
                      tal:content="creator/name_or_id" />
                    <span i18n:translate="task_added_on">on</span>
                <span class="contact-user"
                      tal:content="python:toLocalizedTime(response.date, long_format=True)" />
                    <div tal:repeat="delta response/changes">
                        <span i18n:translate="" tal:content="string:${delta/name}" />:
                    <span class="issueChange"
                          i18n:translate=""
                          i18n:domain="plone"
                          tal:content="delta/before" />
                        &#8594;
                    <span class="issueChange"
                          i18n:translate=""
                          i18n:domain="plone"
                          tal:content="delta/after" />
                    </div>
                </div>
                <span tal:replace="structure html" />

            </div>
        </tal:responses>
        <tal:noadd condition="python:not user.has_permission('Modify portal content', here)">
            <p class="discreet"
               i18n:translate="msg_no_responses_can_be_added">
                No responses can be added.
            </p>
        </tal:noadd>

        <div class="formControls"
             tal:condition="context/@@plone_portal_state/anonymous">
            <div class="login-suggestion">
                <tal:block i18n:translate="login_suggestion_response">
                    If you can, please log in before submitting a reaction.
                </tal:block>
            </div>
            <form
                    tal:attributes="action string:${context/@@plone_portal_state/portal_url}/login_form?came_from=${here/absolute_url}">
                <input class="standalone"
                       type="submit"
                       value="Log in"
                       i18n:domain="plone"
                       i18n:attributes="value label_log_in;"
                        />
            </form>
        </div>

        <tal:add condition="python:user.has_permission('Modify portal content', here)">
            <h3 i18n:translate="title_add_response">Add response</h3>

            <form method="post" action="@@create_response"
                  enctype="multipart/form-data">

                <div class="field">
                    <label for="response"
                           i18n:translate="task_label_response">Response</label>

                    <div class="formHelp" id="response_help"
                         i18n:translate="task_help_response">
                        Please enter your response below
                    </div>
                    <div>
                        <tal:block define="inputname string:response;
                                   inputvalue string:;
                                   member python:context.portal_membership.getAuthenticatedMember();
                                   editor python:member.getProperty('wysiwyg_editor', 'plone_wysiwyg').lower();
                                   portal context/@@plone_portal_state/portal;
                                   portal_url context/@@plone_portal_state/portal_url;
                                   here_url context/@@plone_context_state/object_url;
                                   support python: path('nocall:here/%s_wysiwyg_support|here/%s/wysiwyg_support|here/portal_skins/plone_wysiwyg/wysiwyg_support' % (editor, editor));"
                                   on-error="string:$editor not installed correctly: ${error/value}">

                            <metal:block use-macro="support/macros/wysiwygEditorBox" />
                        </tal:block>
                    </div>

                </div>

                <div class="field"
                     tal:condition="view/transitions_for_display">
                    <label for="transition"
                           i18n:translate="task_label_issueTransition">
                        Change issue state
                    </label>

                    <div class="formHelp"
                         id="issueTransition_help"
                         i18n:translate="task_help_issueTransition">
                        Select a change of state in the issue this response is for, if applicable
                    </div>

                    <tal:transitions
                            repeat="transition view/transitions_for_display">
                        <input class="noborder" name="transition"
                               value="" id="transition_1" type="radio"
                               tal:attributes="value transition/value;
                                 id python:transition['value'] or 'issuetransition-novalue';
                                 checked transition/checked;" />

                        <label
                                i18n:domain="plone"
                                i18n:translate=""
                                tal:attributes="for python:transition['value'] or 'issuetransition-novalue'"
                                tal:content="transition/label" />

                        <br />
                    </tal:transitions>
                </div>


                <div class="field">
                    <label for="priority"
                           i18n:translate="task_label_newPriority">
                        Change task priority
                    </label>

                    <div class="formHelp" id="priority_help"
                         i18n:translate="task_help_newPriority">
                        Select the priority for this task
                    </div>

                    <tal:options
                            repeat="option view/priority_for_display">
                        <input class="noborder" name="priority"
                               value="" id="" type="radio"
                               tal:attributes="value option/value;
                                 id option/value;
                                 checked option/checked;" />

                        <label
                                tal:attributes="for option/value"
                                tal:content="option/label" />

                        <br />
                    </tal:options>
                </div>

                <div class="field"
                     tal:condition="view/responsibles_for_display">
                    <label for="responsible"
                           i18n:translate="task_label_newResponsible">
                        Change responsible manager
                    </label>

                    <div class="formHelp" id="responsible_help"
                         i18n:translate="task_help_newResponsible">
                        Select the responsible for this task
                    </div>

                    <tal:options
                            repeat="option view/responsibles_for_display">
                        <input class="noborder" name="responsible"
                               value="" id="" type="radio"
                               tal:attributes="value option/value;
                                 id option/value;
                                 checked option/checked;" />

                        <label
                                i18n:translate=""
                                tal:attributes="for option/value"
                                tal:content="option/label" />

                        <br />
                    </tal:options>
                </div>

                <div id="formfield-form-widgets-provided_date"
                     class="field z3cformInlineValidation kssattr-fieldname-form.widgets.provided_date">

                    <label class="horizontal" for="form-widgets-provided_date">
                        Data prevista
                    </label>
                    <input type="text" value="" maxlength="2" size="2" class="date-widget date-field" name="form.widgets.provided_date-day" id="form-widgets-provided_date-day"> /
                    <select class="date-widget date-field" name="form.widgets.provided_date-month" id="form-widgets-provided_date-month">
                        <option value="1">janeiro</option>
                        <option value="2">fevereiro</option>
                        <option value="3">mar?o</option>
                        <option value="4">abril</option>
                        <option value="5">maio</option>
                        <option value="6">junho</option>
                        <option value="7">julho</option>
                        <option value="8">agosto</option>
                        <option value="9">setembro</option>
                        <option value="10">outubro</option>
                        <option value="11">novembro</option>
                        <option value="12">dezembro</option>
                    </select> /
                    <input type="text"
                           value=""
                           maxlength="4"
                           size="4"
                           accesskey=""
                           alt=""
                           class="date-widget date-field"
                           name="form.widgets.provided_date-year"
                           id="form-widgets-provided_date-year">
                    <input type="hidden"
                           value="1"
                           name="form.widgets.provided_date-empty-marker"
                           originalvalue="1">
                    <input type="hidden"
                           id="form-widgets-provided_date-calendar"
                           name="form.widgets.provided_date-calendar"
                           class="date" originalvalue="">
                    <a href="#"
                       class="caltrigger"
                       style="background: url(&quot;popup_calendar.gif&quot;) repeat scroll 0% 0% transparent;
                              height: 16px;
                              width: 16px;
                              display: inline-block;
                              vertical-align: middle;">
                    </a>

                </div>

                <div class="formControls">
                    <input class="standalone" value="Submit" type="submit"
                           i18n:domain="plone" i18n:attributes="value"/>
                </div>
            </form>
        </tal:add>

        <div class="visualClear"><!----></div>

    </tal:main-macro>
</metal:main>

</body>
</html>
